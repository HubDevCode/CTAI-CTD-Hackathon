<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Material Forecasting Platform - CTAI-CTD Hackathon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏗️</text></svg>">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-2xl">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-4xl animate-float">🏗️</div>
                    <div>
                        <h1 class="text-3xl font-bold">Construction Material Forecasting</h1>
                        <p class="text-blue-200">CTAI-CTD Hackathon Solution</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <button onclick="showSection('forecasting')" class="hover:text-blue-200 transition-colors">Forecasting</button>
                    <button onclick="showSection('vendors')" class="hover:text-blue-200 transition-colors">Vendors</button>
                    <button onclick="showSection('schedule')" class="hover:text-blue-200 transition-colors">Schedule</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Navigation Tabs -->
        <div class="flex flex-wrap gap-2 mb-8 bg-white rounded-lg p-2 shadow-lg">
            <button onclick="showSection('forecasting')" id="tab-forecasting" class="tab-button active flex-1 md:flex-none">
                📊 Material Forecasting
            </button>
            <button onclick="showSection('vendors')" id="tab-vendors" class="tab-button flex-1 md:flex-none">
                🏢 Vendor Database
            </button>
            <button onclick="showSection('schedule')" id="tab-schedule" class="tab-button flex-1 md:flex-none">
                📅 Project Schedule
            </button>
        </div>

        <!-- Material Forecasting Section -->
        <section id="section-forecasting" class="section-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Form -->
                <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <span class="mr-3">⚙️</span>Project Parameters
                    </h2>
                    
                    <form id="forecastForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Project Type</label>
                            <select id="projectType" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors">
                                <option value="Data Center">🖥️ Data Center</option>
                                <option value="Office Building">🏢 Office Building</option>
                                <option value="Residential Complex">🏠 Residential Complex</option>
                                <option value="Industrial Facility">🏭 Industrial Facility</option>
                                <option value="Healthcare">🏥 Healthcare</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Region</label>
                            <select id="region" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors">
                                <option value="Maharashtra">🇮🇳 Maharashtra</option>
                                <option value="Karnataka">🇮🇳 Karnataka</option>
                                <option value="Delhi">🇮🇳 Delhi</option>
                                <option value="Gujarat">🇮🇳 Gujarat</option>
                                <option value="Tamil Nadu">🇮🇳 Tamil Nadu</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Power Capacity (MW)</label>
                            <input type="number" id="powerCapacity" value="25" min="1" max="100" step="0.1" 
                                   class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors">
                            <p class="text-xs text-gray-500 mt-1">Electrical power requirement for the facility</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Built-up Area (sq ft)</label>
                            <input type="number" id="area" value="200000" min="1000" max="1000000" step="1000"
                                   class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors">
                            <p class="text-xs text-gray-500 mt-1">Total construction area in square feet</p>
                        </div>
                        
                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 font-semibold flex items-center justify-center">
                            <span class="mr-2">🚀</span>Generate AI Forecast
                        </button>
                    </form>
                </div>
                
                <!-- Results -->
                <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <span class="mr-3">📈</span>Forecast Results
                    </h2>
                    
                    <div id="results" class="hidden">
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500 p-6 mb-6 rounded-lg">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">🎯 Primary Material Required</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">Material:</p>
                                    <p class="font-semibold text-gray-800" id="materialName"></p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Item Number:</p>
                                    <p class="font-semibold text-gray-800" id="itemNumber"></p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Quantity:</p>
                                    <p class="font-semibold text-blue-600 text-lg" id="quantity"></p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Confidence:</p>
                                    <p class="font-semibold text-green-600" id="confidence"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg border border-gray-200 p-4">
                            <canvas id="predictionChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                    
                    <div id="loading" class="hidden text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
                        <p class="text-gray-600 font-medium">🤖 AI is analyzing your project...</p>
                    </div>
                    
                    <div id="placeholder" class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">📋</div>
                        <p class="text-lg font-medium">Enter project parameters and click "Generate AI Forecast"</p>
                        <p class="text-sm mt-2">Our AI will predict the required materials for your construction project</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vendors Section -->
        <section id="section-vendors" class="section-content hidden">
            <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="mr-3">🏢</span>Recommended Vendors
                </h2>
                
                <div class="mb-6">
                    <div class="flex flex-wrap gap-3">
                        <button onclick="filterVendors('all')" class="filter-btn active" data-filter="all">All Materials</button>
                        <button onclick="filterVendors('Steel Reinforcement Bars')" class="filter-btn" data-filter="Steel Reinforcement Bars">Steel</button>
                        <button onclick="filterVendors('Concrete Mix')" class="filter-btn" data-filter="Concrete Mix">Concrete</button>
                        <button onclick="filterVendors('Electrical Cables')" class="filter-btn" data-filter="Electrical Cables">Electrical</button>
                        <button onclick="filterVendors('HVAC Equipment')" class="filter-btn" data-filter="HVAC Equipment">HVAC</button>
                    </div>
                </div>
                
                <div id="vendors" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Vendors will be loaded here -->
                </div>
                
                <div id="vendors-loading" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
                    <p class="text-gray-600">Loading vendor database...</p>
                </div>
            </div>
        </section>

        <!-- Schedule Section -->
        <section id="section-schedule" class="section-content hidden">
            <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="mr-3">📅</span>Project Schedule & Timeline
                </h2>
                
                <div id="schedule-content">
                    <div id="schedule-loading" class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
                        <p class="text-gray-600">Loading project schedule...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <p class="text-lg font-semibold mb-2">🏆 CTAI-CTD Hackathon Solution</p>
            <p class="text-gray-400">Construction Material Forecasting Platform</p>
            <p class="text-sm text-gray-500 mt-4">Powered by AI & Machine Learning | Deployed on Vercel</p>
        </div>
    </footer>

    <script>
        let chart = null;
        let currentVendors = {};
        
        // Tab and section management
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`section-${sectionName}`).classList.remove('hidden');
            document.getElementById(`tab-${sectionName}`).classList.add('active');
            
            // Load data for specific sections
            if (sectionName === 'vendors') {
                loadVendors();
            } else if (sectionName === 'schedule') {
                loadSchedule();
            }
        }
        
        // Form submission
        document.getElementById('forecastForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading
            document.getElementById('placeholder').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            
            // Collect form data
            const formData = {
                project_type: document.getElementById('projectType').value,
                region: document.getElementById('region').value,
                power_capacity: parseFloat(document.getElementById('powerCapacity').value),
                area: parseFloat(document.getElementById('area').value)
            };
            
            try {
                // Call prediction API
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                // Display results
                document.getElementById('materialName').textContent = result.material_name;
                document.getElementById('itemNumber').textContent = result.master_item;
                document.getElementById('quantity').textContent = `${result.quantity} units`;
                document.getElementById('confidence').textContent = `${Math.round(result.confidence * 100)}%`;
                
                // Create chart
                createChart(result.quantity, result.material_name);
                
                // Show results
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('placeholder').innerHTML = '<div class="text-center"><div class="text-4xl mb-4">❌</div><p class="text-red-500 font-medium">Error generating forecast. Please try again.</p></div>';
                document.getElementById('placeholder').classList.remove('hidden');
            }
        });
        
        function createChart(quantity, materialName) {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [materialName, 'Other Materials'],
                    datasets: [{
                        data: [quantity, Math.max(10, quantity * 0.3)],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(156, 163, 175, 0.3)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(156, 163, 175, 0.5)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        title: {
                            display: true,
                            text: `Material Distribution for ${materialName}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    }
                }
            });
        }
        
        async function loadVendors() {
            try {
                document.getElementById('vendors-loading').style.display = 'block';
                
                const response = await fetch('/api/vendors');
                const vendors = await response.json();
                currentVendors = vendors;
                
                displayVendors(vendors);
                document.getElementById('vendors-loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading vendors:', error);
                document.getElementById('vendors').innerHTML = '<div class="col-span-full text-center text-red-500 py-8">Error loading vendors</div>';
                document.getElementById('vendors-loading').style.display = 'none';
            }
        }
        
        function displayVendors(vendors) {
            const vendorsContainer = document.getElementById('vendors');
            vendorsContainer.innerHTML = '';
            
            Object.entries(vendors).forEach(([material, vendorList]) => {
                vendorList.forEach(vendor => {
                    const vendorCard = document.createElement('div');
                    vendorCard.className = 'vendor-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-lg border border-gray-200 hover:shadow-lg transition-all duration-300';
                    vendorCard.setAttribute('data-material', material);
                    vendorCard.innerHTML = `
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="font-bold text-lg text-gray-800 leading-tight">${vendor.name}</h3>
                            <div class="flex items-center text-yellow-500">
                                <span class="text-lg">⭐</span>
                                <span class="ml-1 font-semibold">${vendor.rating}</span>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p class="flex items-center text-gray-600">
                                <span class="mr-2">📍</span>${vendor.location}
                            </p>
                            <p class="flex items-center text-gray-600">
                                <span class="mr-2">📞</span>${vendor.contact}
                            </p>
                            <p class="flex items-center text-gray-600">
                                <span class="mr-2">💰</span>${vendor.price_range || 'Contact for pricing'}
                            </p>
                            <p class="flex items-center text-gray-600">
                                <span class="mr-2">🚚</span>${vendor.delivery_time || 'Standard delivery'}
                            </p>
                        </div>
                        <div class="mt-4">
                            <p class="text-xs text-gray-500 mb-2">Specializations:</p>
                            <div class="flex flex-wrap gap-1">
                                ${vendor.services.map(service => 
                                    `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">${service}</span>`
                                ).join('')}
                            </div>
                        </div>
                        ${vendor.certifications ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p class="text-xs text-gray-500 mb-1">Certifications:</p>
                                <div class="flex flex-wrap gap-1">
                                    ${vendor.certifications.map(cert => 
                                        `<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">${cert}</span>`
                                    ).join('')}
                                </div>
                            </div>
                        ` : ''}
                    `;
                    vendorsContainer.appendChild(vendorCard);
                });
            });
        }
        
        function filterVendors(materialType) {
            // Update filter button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${materialType}"]`).classList.add('active');
            
            // Filter vendor cards
            const vendorCards = document.querySelectorAll('.vendor-card');
            vendorCards.forEach(card => {
                if (materialType === 'all' || card.getAttribute('data-material') === materialType) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        async function loadSchedule() {
            try {
                const response = await fetch('/api/schedule');
                const scheduleData = await response.json();
                
                displaySchedule(scheduleData);
                
            } catch (error) {
                console.error('Error loading schedule:', error);
                document.getElementById('schedule-content').innerHTML = '<div class="text-center text-red-500 py-8">Error loading schedule</div>';
            }
        }
        
        function displaySchedule(scheduleData) {
            const content = document.getElementById('schedule-content');
            content.innerHTML = `
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">📊 Project Overview</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-blue-600 font-semibold">Project Duration</p>
                            <p class="text-2xl font-bold text-blue-800">${scheduleData.project_info.estimated_duration_days} days</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-green-600 font-semibold">Start Date</p>
                            <p class="text-lg font-bold text-green-800">${new Date(scheduleData.project_info.start_date).toLocaleDateString()}</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-purple-600 font-semibold">Total Phases</p>
                            <p class="text-2xl font-bold text-purple-800">${scheduleData.phases.length}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">🎯 Project Phases</h3>
                    <div class="space-y-4">
                        ${scheduleData.phases.map((phase, index) => `
                            <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">${index + 1}. ${phase.phase}</h4>
                                    <span class="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded">${phase.duration_days} days</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">Start: ${new Date(phase.start_date).toLocaleDateString()}</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    ${phase.tasks.map(task => `
                                        <div class="bg-white p-2 rounded text-sm">
                                            <span class="font-medium">${task.name}</span>
                                            <span class="text-gray-500 ml-2">(${task.duration} days)</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">🚚 Procurement Timeline</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg shadow">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left font-semibold">Material</th>
                                    <th class="px-4 py-3 text-left font-semibold">Order Date</th>
                                    <th class="px-4 py-3 text-left font-semibold">Delivery Date</th>
                                    <th class="px-4 py-3 text-left font-semibold">Lead Time</th>
                                    <th class="px-4 py-3 text-left font-semibold">Required For</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${scheduleData.procurement_timeline.map(item => `
                                    <tr class="border-t border-gray-200">
                                        <td class="px-4 py-3 font-medium">${item.material}</td>
                                        <td class="px-4 py-3">${new Date(item.order_date).toLocaleDateString()}</td>
                                        <td class="px-4 py-3">${new Date(item.delivery_date).toLocaleDateString()}</td>
                                        <td class="px-4 py-3">${item.lead_time_days} days</td>
                                        <td class="px-4 py-3">${item.required_for}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // CSS for tabs and filters
        const style = document.createElement('style');
        style.textContent = `
            .tab-button {
                padding: 12px 24px;
                border-radius: 8px;
                border: 2px solid transparent;
                background: transparent;
                color: #6b7280;
                font-weight: 500;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            .tab-button:hover {
                background: #f3f4f6;
                color: #374151;
            }
            .tab-button.active {
                background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                color: white;
                border-color: #3b82f6;
            }
            .filter-btn {
                padding: 8px 16px;
                border-radius: 20px;
                border: 2px solid #e5e7eb;
                background: white;
                color: #6b7280;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            .filter-btn:hover {
                border-color: #3b82f6;
                color: #3b82f6;
            }
            .filter-btn.active {
                background: #3b82f6;
                color: white;
                border-color: #3b82f6;
            }
        `;
        document.head.appendChild(style);
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            showSection('forecasting');
        });
    </script>
</body>
</html>